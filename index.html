<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversio - Editor de texto</title>
    
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&amp;display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <!-- MathJax -->
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://fadsf.h5p.com/js/h5p-resizer.js" charset="UTF-8"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                tags: 'none'
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                ready: () => {
                    MathJax.startup.defaultReady();
                    MathJax.typesetPromise();
                }
            }
        };
    </script>

    <style>
        /* Estilos generales */
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: url('https://www.henryford.edu.ar/_next/image?url=https%3A%2F%2Fcms.henryford.edu.ar%2Fuploads%2F20210513_091910_2b8b6be8b8.jpg&w=1920&q=75') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 1300px;
            margin: 20px auto;
        }

        .logo-container {
            text-align: center;
            margin: 0 auto 20px;
            width: 100%;
        }

        .logo-container1 {
            text-align: center;
            margin: 0 auto 20px;
            width: 100%;
        }

        .logo-container img {
            width: 120px;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        .logo-container1 img {
            width: 60px;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        h1 {
            color: #007bff;
            text-align: center;
            margin-bottom: 30px;
        }

        textarea {
            width: 100%;
            height: 80px;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        textarea:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }
    
      
            /* Estilos de la barra de herramientas */
        .editor-toolbar {
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(248, 249, 250, 0.95);
            backdrop-filter: blur(8px);
            padding: 10px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s ease;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
          
        }

        .editor-toolbar.sticky {
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .toolbar-group {
            display: flex;
            gap: 5px;
            align-items: center;
            padding-right: 10px;
            border-right: 1px solid #ddd;
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .tool-button {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            transition: all 0.2s ease;
        }
      
      .tool-button1 {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 6px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            transition: all 0.2s ease;
        color: white;
        font-weight: bold;
        }

        .tool-button:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .tool-button.active {
            background: #007bff;
            color: white;
            border-color: #0056b3;
        }

        .tool-button i {
            font-size: 14px;
        }

        .color-picker {
            width: 30px;
            height: 30px;
            padding: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: white;
        }

        .color-picker::-webkit-color-swatch {
            border: none;
            border-radius: 2px;
            padding: 0;
        }

        .color-picker::-webkit-color-swatch-wrapper {
            border: none;
            border-radius: 2px;
            padding: 0;
        }

        .font-size-selector {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 14px;
            cursor: pointer;
        }

        /* Estilos para tablas */
        .rubrica-tabla {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }

        .rubrica-tabla th,
        .rubrica-tabla td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            vertical-align: top;
        }

        .rubrica-tabla th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        .rubrica-tabla tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .rubrica-tabla tr:hover {
            background-color: #f5f5f5;
        }

        /* Diálogo de medios */
        .media-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 90%;
            max-width: 600px;
            min-height: 200px;
        }

        .media-dialog-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .media-preview-container {
            margin: 15px 0;
            text-align: center;
        }

        .media-preview-container img,
        .media-preview-container video {
            max-width: 100%;
            max-height: 400px;
            margin: auto;
        }

        .media-preview-container audio {
            width: 100%;
        }

        .dialog-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
        }

        /* Botones principales */
        .buttons-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            
        }

        .button {
            background: linear-gradient(to bottom, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            min-width: 200px;
            transition: all 0.2s ease;
        }

        .button:hover {
            transform: translateY(-2px);
        }

        #clearButton {
            background: linear-gradient(to bottom, #dc3545, #bd2130);
        }

        #printButton {
            background: linear-gradient(to bottom, #28a745, #1e7e34);
        }

        #downloadButton {
            background: linear-gradient(to bottom, #007bff, #0056b3);
        }

        /* Área de previsualización */
        .preview-content {
            margin: 20px auto;
            padding: 40px;
            background: white;
            border-radius: 8px;
            display: none ;
            width: 100%;
          
            box-sizing: border-box;
          resize: both;
        }

        #contenidoRubrica {
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 20px;
            outline: none;
          resize: vertical;
          
        }

        #contenidoRubrica:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
        }

        /* Grabación */
        .recording {
            animation: pulse 1.5s infinite;
            background: #dc3545 !important;
            color: white !important;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Estilos para fórmulas matemáticas */
        .math-formula {
            margin: 1em 0;
            overflow-x: auto;
            max-width: 100%;
            padding: 10px 0;
        }

        .MathJax {
            font-size: 110% !important;
        }

        /* Estilos de impresión */
        @media print {
            .no-print {
                display: none !important;
            }

            .preview-content {
                display: block !important;
                padding: 20px;
                margin: 0;
                width: 100%;
                border-radius: 0;
            }

            .rubrica-tabla {
                page-break-inside: avoid;
            }

            .rubrica-tabla th,
            .rubrica-tabla td {
                border-color: #000;
            }

            .MathJax {
                page-break-inside: avoid;
            }

            * { 
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }

        /* Responsive */
        @media screen and (max-width: 768px) {
            .container {
                width: 95%;
                padding: 15px;
            }

            .buttons-container {
                flex-direction: column;
            }

            .button {
                width: 100%;
            }

            .editor-toolbar {
                flex-direction: column;
            }

            .toolbar-group {
                border-right: none;
                border-bottom: 1px solid #ddd;
                padding-bottom: 10px;
                width: 100%;
                justify-content: center;
            }
        }
      .custom-dialog-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .custom-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            width: 90%;
            max-width: 500px;
        }

        .custom-dialog h3 {
            margin-top: 0;
            color: #007bff;
            margin-bottom: 20px;
        }

        .custom-dialog-content {
            margin-bottom: 20px;
        }

        .custom-dialog input[type="text"],
        .custom-dialog input[type="url"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .custom-dialog input[type="text"]:focus,
        .custom-dialog input[type="url"]:focus {
            border-color: #007bff;
            outline: none;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .dialog-button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .dialog-button-primary {
            background: #007bff;
            color: white;
        }

        .dialog-button-primary:hover {
            background: #0056b3;
        }

        .dialog-button-secondary {
            background: #6c757d;
            color: white;
        }

        .dialog-button-secondary:hover {
            background: #545b62;
        }

        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: -10px;
            margin-bottom: 10px;
            display: none;
        }
      
      
      .preview-content img,
        .preview-content iframe {
            cursor: move;
            position: relative;
            max-width: 100%;
            height: auto;
        }
   /* Estilos para los diálogos de grabación */
.recording-dialog {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    z-index: 1001;
    width: 90%;
    max-width: 500px;
}

.recording-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(3px);
    z-index: 1000;
}

.recording-content {
    text-align: center;
}

.recording-preview {
    margin: 20px 0;
    width: 100%;
    min-height: 200px;
    background: #f8f9fa;
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
}

.recording-preview video {
    max-width: 100%;
    max-height: 300px;
}

.recording-preview audio {
    width: 100%;
    margin: 10px;
}

.recording-timer {
    font-size: 24px;
    font-weight: bold;
    color: #dc3545;
    margin: 15px 0;
    font-family: monospace;
}

.recording-controls {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin: 20px 0;
}

.recording-button {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.record-button {
    background: #dc3545;
    color: white;
}

.record-button:hover {
    background: #c82333;
}

.record-button.recording {
    animation: pulse 1.5s infinite;
}

.stop-button {
    background: #6c757d;
    color: white;
}

.stop-button:hover {
    background: #5a6268;
}

.save-button {
    background: #28a745;
    color: white;
}

.save-button:hover {
    background: #218838;
}

.cancel-button {
    background: #6c757d;
    color: white;
}

.cancel-button:hover {
    background: #5a6268;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.recording-status {
    font-size: 14px;
    margin: 10px 0;
    color: #6c757d;
}

.recording-error {
    color: #dc3545;
    margin: 10px 0;
    font-size: 14px;
    display: none;
}
      
      /* Estilos para elementos seleccionados */
.media-selected {
    outline: 2px solid #007bff;
    border-radius: 4px;
}

/* Estilos para el contenedor de medios */
.media-container {
    display: inline-block;
    margin: 10px;
    transition: all 0.3s ease;
}

.media-container.align-left {
    float: left;
    margin-right: 20px;
}

.media-container.align-center {
    display: block;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
}

.media-container.align-right {
    float: right;
    margin-left: 20px;
}

/* Estilos para el botón de redimensionar */
.resize-handle {
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: #007bff;
    border-radius: 50%;
    cursor: se-resize;
    display: none;
}
      .saved-edit-item {
    background: white;
    border-radius: 4px;
    margin-bottom: 10px;
    transition: background-color 0.2s;
}

.saved-edit-item:hover {
    background: #f8f9fa;
}

.saved-edit-item button {
    margin-right: 8px;
}

/* Estilo para el botón de autoguardado cuando está activo */
.autosave-active {
    background-color: #28a745 !important;
    color: white !important;
}

/* Indicador de autoguardado */
.autosave-indicator {
    font-size: 12px;
    color: #6c757d;
    margin-left: 10px;
    opacity: 0;
    transition: opacity 0.3s;
}

.autosave-indicator.visible {
    opacity: 1;
}
      
      
      /* Estilos para el contenedor de H5P */
.h5p-container {
    position: relative; /* Para posicionar el manejador */
    display: inline-block;
    margin: 10px;
}

/* Estilos para el manejador de redimensión */
.resize-handle {
    position: absolute;
    bottom: 5px;
    right: 5px;
    width: 10px;
    height: 10px;
    background-color: #007bff;
    border-radius: 50%;
    cursor: se-resize;
}
      
      .media-tools {
    display: flex;
    gap: 8px;
    padding: 5px;
}

.tool-button {
    padding: 5px 10px;
    cursor: pointer;
    background: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 4px;
}

.tool-button:hover {
    background: #e0e0e0;
}

/* Asegurarse de que las imágenes y videos sean responsivos inicialmente */
img.resizable, 
iframe.resizable {
    max-width: 100%;
    height: auto;
    display: block;
}
      
      .preview-area {
    position: relative;
    min-height: 400px;
    border: 1px solid #ccc;
    overflow: hidden;
}

.draggable {
    cursor: move;
    position: absolute;
    user-select: none;
}
      
      .media-tools1 {
            position: fixed;
            display: none;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px;
            gap: 5px;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
      
      .image-source-tabs {
    display: flex;
    margin-bottom: 15px;
    border-bottom: 1px solid #ddd;
}

.tab-button {
    padding: 8px 16px;
    border: none;
    background: none;
    cursor: pointer;
    margin-right: 10px;
    border-bottom: 2px solid transparent;
}

.tab-button.active {
    border-bottom: 2px solid #007bff;
    color: #007bff;
}

.tab-content {
    margin-bottom: 15px;
}

#imageFile {
    padding: 10px 0;
}
      
      .math-formula {
    transition: transform 0.3s ease;
    display: inline-block;
    transform-origin: left center;
}

.math-formula.size-large {
    transform: scale(1.5);
    margin: 0.5em 0;
}

.math-formula.size-small {
    transform: scale(0.8);
    margin: 0.2em 0;
}

/* Para el ícono superpuesto */
.tool-button {
    position: relative;
}

.tool-button i.fa-plus,
.tool-button i.fa-minus {
    font-size: 8px;
    position: absolute;
    top: 8px;
    right: 8px;
}
      
</style>
<style type="text/css">

</style>
<script>

</script>
<style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style id="MJX-CHTML-styles">
mjx-container[jax="CHTML"] {
  line-height: 0;
}

mjx-container [space="1"] {
  margin-left: .111em;
}

mjx-container [space="2"] {
  margin-left: .167em;
}

mjx-container [space="3"] {
  margin-left: .222em;
}

mjx-container [space="4"] {
  margin-left: .278em;
}

mjx-container [space="5"] {
  margin-left: .333em;
}

mjx-container [rspace="1"] {
  margin-right: .111em;
}

mjx-container [rspace="2"] {
  margin-right: .167em;
}

mjx-container [rspace="3"] {
  margin-right: .222em;
}

mjx-container [rspace="4"] {
  margin-right: .278em;
}

mjx-container [rspace="5"] {
  margin-right: .333em;
}

mjx-container [size="s"] {
  font-size: 70.7%;
}

mjx-container [size="ss"] {
  font-size: 50%;
}

mjx-container [size="Tn"] {
  font-size: 60%;
}

mjx-container [size="sm"] {
  font-size: 85%;
}

mjx-container [size="lg"] {
  font-size: 120%;
}

mjx-container [size="Lg"] {
  font-size: 144%;
}

mjx-container [size="LG"] {
  font-size: 173%;
}

mjx-container [size="hg"] {
  font-size: 207%;
}

mjx-container [size="HG"] {
  font-size: 249%;
}

mjx-container [width="full"] {
  width: 100%;
}

mjx-box {
  display: inline-block;
}

mjx-block {
  display: block;
}

mjx-itable {
  display: inline-table;
}

mjx-row {
  display: table-row;
}

mjx-row > * {
  display: table-cell;
}

mjx-mtext {
  display: inline-block;
}

mjx-mstyle {
  display: inline-block;
}

mjx-merror {
  display: inline-block;
  color: red;
  background-color: yellow;
}

mjx-mphantom {
  visibility: hidden;
}

_::-webkit-full-page-media, _:future, :root mjx-container {
  will-change: opacity;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-c::before {
  display: block;
  width: 0;
}

.MJX-TEX {
  font-family: MJXZERO, MJXTEX;
}

.TEX-B {
  font-family: MJXZERO, MJXTEX-B;
}

.TEX-I {
  font-family: MJXZERO, MJXTEX-I;
}

.TEX-MI {
  font-family: MJXZERO, MJXTEX-MI;
}

.TEX-BI {
  font-family: MJXZERO, MJXTEX-BI;
}

.TEX-S1 {
  font-family: MJXZERO, MJXTEX-S1;
}

.TEX-S2 {
  font-family: MJXZERO, MJXTEX-S2;
}

.TEX-S3 {
  font-family: MJXZERO, MJXTEX-S3;
}

.TEX-S4 {
  font-family: MJXZERO, MJXTEX-S4;
}

.TEX-A {
  font-family: MJXZERO, MJXTEX-A;
}

.TEX-C {
  font-family: MJXZERO, MJXTEX-C;
}

.TEX-CB {
  font-family: MJXZERO, MJXTEX-CB;
}

.TEX-FR {
  font-family: MJXZERO, MJXTEX-FR;
}

.TEX-FRB {
  font-family: MJXZERO, MJXTEX-FRB;
}

.TEX-SS {
  font-family: MJXZERO, MJXTEX-SS;
}

.TEX-SSB {
  font-family: MJXZERO, MJXTEX-SSB;
}

.TEX-SSI {
  font-family: MJXZERO, MJXTEX-SSI;
}

.TEX-SC {
  font-family: MJXZERO, MJXTEX-SC;
}

.TEX-T {
  font-family: MJXZERO, MJXTEX-T;
}

.TEX-V {
  font-family: MJXZERO, MJXTEX-V;
}

.TEX-VB {
  font-family: MJXZERO, MJXTEX-VB;
}

mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c {
  font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A ! important;
}

@font-face /* 0 */ {
  font-family: MJXZERO;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Zero.woff") format("woff");
}

@font-face /* 1 */ {
  font-family: MJXTEX;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff") format("woff");
}

@font-face /* 2 */ {
  font-family: MJXTEX-B;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Bold.woff") format("woff");
}

@font-face /* 3 */ {
  font-family: MJXTEX-I;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-Italic.woff") format("woff");
}

@font-face /* 4 */ {
  font-family: MJXTEX-MI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Italic.woff") format("woff");
}

@font-face /* 5 */ {
  font-family: MJXTEX-BI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-BoldItalic.woff") format("woff");
}

@font-face /* 6 */ {
  font-family: MJXTEX-S1;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff") format("woff");
}

@font-face /* 7 */ {
  font-family: MJXTEX-S2;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size2-Regular.woff") format("woff");
}

@font-face /* 8 */ {
  font-family: MJXTEX-S3;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size3-Regular.woff") format("woff");
}

@font-face /* 9 */ {
  font-family: MJXTEX-S4;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size4-Regular.woff") format("woff");
}

@font-face /* 10 */ {
  font-family: MJXTEX-A;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_AMS-Regular.woff") format("woff");
}

@font-face /* 11 */ {
  font-family: MJXTEX-C;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Regular.woff") format("woff");
}

@font-face /* 12 */ {
  font-family: MJXTEX-CB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Bold.woff") format("woff");
}

@font-face /* 13 */ {
  font-family: MJXTEX-FR;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Regular.woff") format("woff");
}

@font-face /* 14 */ {
  font-family: MJXTEX-FRB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Bold.woff") format("woff");
}

@font-face /* 15 */ {
  font-family: MJXTEX-SS;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Regular.woff") format("woff");
}

@font-face /* 16 */ {
  font-family: MJXTEX-SSB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Bold.woff") format("woff");
}

@font-face /* 17 */ {
  font-family: MJXTEX-SSI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Italic.woff") format("woff");
}

@font-face /* 18 */ {
  font-family: MJXTEX-SC;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Script-Regular.woff") format("woff");
}

@font-face /* 19 */ {
  font-family: MJXTEX-T;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Typewriter-Regular.woff") format("woff");
}

@font-face /* 20 */ {
  font-family: MJXTEX-V;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Regular.woff") format("woff");
}

@font-face /* 21 */ {
  font-family: MJXTEX-VB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Bold.woff") format("woff");
}
</style><style type="text/css">

</style>
<script>

</script>
<style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">

</style>
<script>

</script>
<style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style type="text/css">

</style>
<script>

</script>
<style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style></head>
  <body>
    <div class="container">
        <div class="logo-container no-print">
            <img src="https://www.henryford.edu.ar/uploads/logo512_f4b4cdb9e9.png" alt="Logo Henry Ford" id="headerLogo">
        </div>
        <h1 class="no-print">Conversio</h1>
        
        <textarea id="rubricaInput" class="no-print" placeholder="Pegá aquí el texto generado por la IA..."></textarea>
        
       
        
        <!-- Barra de herramientas -->
        <div class="editor-toolbar no-print">
            <div class="toolbar-group">
                <button class="tool-button" onclick="formatText('bold')" title="Negrita">
                    <i class="fas fa-bold"></i>
                </button>
                <button class="tool-button" onclick="formatText('italic')" title="Cursiva">
                    <i class="fas fa-italic"></i>
                </button>
                <button class="tool-button" onclick="formatText('underline')" title="Subrayado">
                    <i class="fas fa-underline"></i>
                </button>
            </div>
            <div class="toolbar-group">
                <input type="color" class="color-picker" onchange="changeColor(this.value)" title="Color de texto">
            </div>
          <div class="toolbar-group">
    <input type="color" class="color-picker" id="highlightColorPicker" value="#ffff00" title="Color de resaltado">
    <button class="tool-button" onclick="applyHighlight()" title="Resaltar">
        <i class="fas fa-highlighter"></i>
    </button>
</div>
            <div class="toolbar-group">
                <button class="tool-button" onclick="formatText('justifyLeft')" title="Alinear a la izquierda">
                    <i class="fas fa-align-left"></i>
                </button>
                <button class="tool-button" onclick="formatText('justifyCenter')" title="Centrar">
                    <i class="fas fa-align-center"></i>
                </button>
                <button class="tool-button" onclick="formatText('justifyRight')" title="Alinear a la derecha">
                    <i class="fas fa-align-right"></i>
                </button>
                <button class="tool-button" onclick="formatText('justifyFull')" title="Justificar">
                    <i class="fas fa-align-justify"></i>
                </button>
            </div>
            
            <div class="toolbar-group">
                
              <button class="tool-button" onclick="insertLink()" title="Insertar enlace">
                    <i class="fas fa-link"></i>
                </button>
                <button class="tool-button" onclick="insertImage()" title="Insertar imagen">
                    <i class="fas fa-image"></i>
                </button>
                <button class="tool-button" onclick="insertVideo()" title="Insertar video">
                    <i class="fas fa-video"></i>
                </button>
            </div>
          
          <div class="toolbar-group media-tools" style="display: none;">
    <button class="tool-button" onclick="decreaseMediaSize()" title="Reducir tamaño">
        <i class="fas fa-compress-arrows-alt"></i>
    </button>
    <button class="tool-button" onclick="increaseMediaSize()" title="Aumentar tamaño">
        <i class="fas fa-expand-arrows-alt"></i>
    </button>
</div>
          
            <div class="toolbar-group">
                <button class="tool-button" onclick="formatText('insertUnorderedList')" title="Lista con viñetas">
                    <i class="fas fa-list-ul"></i>
                </button>
                <button class="tool-button" onclick="formatText('insertOrderedList')" title="Lista numerada">
                    <i class="fas fa-list-ol"></i>
                </button>
            </div>
            <div class="toolbar-group">
                <button class="tool-button" onclick="formatText('indent')" title="Aumentar sangría">
                    <i class="fas fa-indent"></i>
                </button>
                <button class="tool-button" onclick="formatText('outdent')" title="Disminuir sangría">
                    <i class="fas fa-outdent"></i>
                </button>
            </div>
          
            <div class="toolbar-group">
                <select class="font-size-selector" onchange="changeFontSize(this.value)" title="Tamaño de fuente">
                    <option value="">Tamaño de texto</option>
                    <option value="1">Muy pequeño</option>
                    <option value="2">Pequeño</option>
                    <option value="3">Normal</option>
                    <option value="4">Grande</option>
                    <option value="5">Más grande</option>
                    <option value="6">Muy grande</option>
                    <option value="7">Máximo</option>
                </select>
            </div>
          <div class="toolbar-group">
    <button class="tool-button" onclick="insertH5P()" title="Insertar H5P">
        <i class="fas fa-puzzle-piece"></i>
    </button>
</div>
          
          
          
            <div class="toolbar-group">
                <button class="tool-button" onclick="showRecordingDialog('audio')" id="audioRecordButton" title="Grabar audio">
    <i class="fas fa-microphone"></i>
</button>
<button class="tool-button" onclick="showRecordingDialog('video')" id="videoRecordButton" title="Grabar video">
    <i class="fas fa-camera"></i>
</button>
            </div>
          <div class="toolbar-group">
    <button class="tool-button1" id="printButton" onclick="imprimirContenido()"><i class="fas fa-print"></i> </button>
    <button class="tool-button1" id="downloadButton" onclick="descargarContenido()"><i class="fas fa-download"></i> </button>
    <button class="tool-button1" id="clearButton" onclick="borrarContenido()"><i class="fas fa-trash"></i> </button>
  </div>
  </div>
   
        <!-- Contenido de previsualización -->
        <div id="preview" class="preview-content">
            <div class="logo-container1">
                <img src="https://www.henryford.edu.ar/uploads/logo512_f4b4cdb9e9.png" alt="Logo Henry Ford">
            </div>
            
            <div id="contenidoRubrica" contenteditable="true"></div>
          
        </div>

        <!-- Diálogo para vista previa de medios -->
        <div id="mediaDialogOverlay" class="media-dialog-overlay"></div>
        <div id="mediaDialog" class="media-dialog">
            <h3>Vista previa</h3>
            <div id="mediaPreviewContainer" class="media-preview-container"></div>
            <div class="dialog-buttons">
                <button class="button" onclick="insertCurrentMedia()">Insertar</button>
                <button class="button" onclick="closeMediaDialog()">Cancelar</button>
            </div>
        </div>
      
       <div id="linkDialogOverlay" class="custom-dialog-overlay"></div>
    <div id="linkDialog" class="custom-dialog">
        <h3>Insertar enlace</h3>
        <div class="custom-dialog-content">
            <input type="url" id="linkUrl" placeholder="Ingresa la URL del enlace">
            <div id="linkUrlError" class="error-message">Por favor, ingresa una URL válida</div>
            <input type="text" id="linkText" placeholder="Texto para mostrar">
        </div>
        <div class="dialog-buttons">
            <button class="dialog-button dialog-button-secondary" onclick="closeCustomDialog('linkDialog')">Cancelar</button>
            <button class="dialog-button dialog-button-primary" onclick="insertCustomLink()">Insertar</button>
        </div>
    </div>

    <!-- Diálogo para imágenes -->
    <div id="imageDialogOverlay" class="custom-dialog-overlay"></div>
    <div id="imageDialog" class="custom-dialog">
    <h3>Insertar imagen</h3>
    <div class="custom-dialog-content">
        <div class="image-source-tabs">
            <button class="tab-button active" onclick="switchImageTab('url')">URL</button>
            <button class="tab-button" onclick="switchImageTab('file')">Archivo Local</button>
        </div>
        <div id="urlTab" class="tab-content">
            <input type="url" id="imageUrl" placeholder="Ingresa la URL de la imagen">
            <div id="imageUrlError" class="error-message">Por favor, ingresa una URL válida</div>
        </div>
        <div id="fileTab" class="tab-content" style="display:none;">
            <input type="file" id="imageFile" accept="image/*">
            <div id="imageFileError" class="error-message">Por favor, selecciona una imagen válida</div>
        </div>
    </div>
    <div class="dialog-buttons">
        <button class="dialog-button dialog-button-secondary" onclick="closeCustomDialog('imageDialog')">Cancelar</button>
        <button class="dialog-button dialog-button-primary" onclick="insertCustomImage()">Insertar</button>
    </div>
</div>
    </div>

    <!-- Diálogo para videos -->
    <div id="videoDialogOverlay" class="custom-dialog-overlay"></div>
    <div id="videoDialog" class="custom-dialog">
        <h3>Insertar video</h3>
        <div class="custom-dialog-content">
            <input type="url" id="videoUrl" placeholder="Ingresa la URL del video (YouTube o URL directa)">
            <div id="videoUrlError" class="error-message">Por favor, ingresa una URL válida</div>
        </div>
        <div class="dialog-buttons">
            <button class="dialog-button dialog-button-secondary" onclick="closeCustomDialog('videoDialog')">Cancelar</button>
            <button class="dialog-button dialog-button-primary" onclick="insertCustomVideo()">Insertar</button>
        </div>
    </div>

    <!-- Diálogo para H5P -->
    <div id="h5pDialogOverlay" class="custom-dialog-overlay"></div>
    <div id="h5pDialog" class="custom-dialog">
        <h3>Insertar contenido H5P</h3>
        <div class="custom-dialog-content">
            <input type="url" id="h5pUrl" placeholder="Ingresa la URL del contenido H5P">
            <div id="h5pUrlError" class="error-message">Por favor, ingresa una URL válida</div>
        </div>
        <div class="dialog-buttons">
            <button class="dialog-button dialog-button-secondary" onclick="closeCustomDialog('h5pDialog')">Cancelar</button>
            <button class="dialog-button dialog-button-primary" onclick="insertCustomH5P()">Insertar</button>
        </div>
    </div>
<div id="audioRecordingOverlay" class="recording-overlay"></div>
<div id="audioRecordingDialog" class="recording-dialog">
    <h3>Grabar Audio</h3>
    <div class="recording-content">
        <div class="recording-preview">
            <audio id="audioPreview" controls=""></audio>
        </div>
        <div class="recording-timer" id="audioTimer">00:00</div>
        <div class="recording-status" id="audioStatus">Listo para grabar</div>
        <div class="recording-error" id="audioError"></div>
        <div class="recording-controls">
            <button class="recording-button record-button" id="startAudioRecord">
                <i class="fas fa-microphone"></i> Grabar
            </button>
            <button class="recording-button stop-button" id="stopAudioRecord" style="display:none">
                <i class="fas fa-stop"></i> Detener
            </button>
            <button class="recording-button save-button" id="saveAudioRecord" style="display:none">
                <i class="fas fa-save"></i> Guardar
            </button>
            <button class="recording-button cancel-button" id="cancelAudioRecord">
                <i class="fas fa-times"></i> Cancelar
            </button>
        </div>
    </div>
</div>

<!-- Diálogo para grabación de video -->
<div id="videoRecordingOverlay" class="recording-overlay"></div>
<div id="videoRecordingDialog" class="recording-dialog">
    <h3>Grabar Video</h3>
    <div class="recording-content">
        <div class="recording-preview">
            <video id="videoPreview" autoplay="" muted="" playsinline=""></video>
        </div>
        <div class="recording-timer" id="videoTimer">00:00</div>
        <div class="recording-status" id="videoStatus">Listo para grabar</div>
        <div class="recording-error" id="videoError"></div>
        <div class="recording-controls">
            <button class="recording-button record-button" id="startVideoRecord">
                <i class="fas fa-video"></i> Grabar
            </button>
            <button class="recording-button stop-button" id="stopVideoRecord" style="display:none">
                <i class="fas fa-stop"></i> Detener
            </button>
            <button class="recording-button save-button" id="saveVideoRecord" style="display:none">
                <i class="fas fa-save"></i> Guardar
            </button>
            <button class="recording-button cancel-button" id="cancelVideoRecord">
                <i class="fas fa-times"></i> Cancelar
            </button>
        </div>
    </div>
</div>
    <script>
      
      // Parte 1: Funciones principales del editor
// Función principal de formateo de texto con soporte para fórmulas
function formatearTexto(texto) {
    let formatoHTML = texto;

    // Preservar fórmulas matemáticas primero
    const formulas = [];
    let index = 0;

    // Guardar fórmulas en bloque
    formatoHTML = formatoHTML.replace(/\$\$([\s\S]*?)\$\$/g, function(match) {
        formulas.push(match);
        return `##FORMULA${index++}##`;
    });

    // Guardar fórmulas inline
    formatoHTML = formatoHTML.replace(/\$([\s\S]*?)\$/g, function(match) {
        formulas.push(match);
        return `##FORMULA${index++}##`;
    });

    // Procesar las tablas en su lugar
    let lines = formatoHTML.split('\n');
    let newLines = [];
    let tableLines = [];
    let inTable = false;

    for (let i = 0; i < lines.length; i++) {
        let line = lines[i].trim();
        
        if (line.startsWith('|')) {
            if (!inTable) {
                inTable = true;
                tableLines = [];
                tableLines.push(line);
            } else {
                tableLines.push(line);
            }
        } else {
            if (inTable) {
                // Construir la tabla HTML
                let tableHTML = '<table class="rubrica-tabla">\n';
                let isHeader = true;
                
                tableLines.forEach((tableLine, index) => {
                    // Ignorar líneas de separación (que contienen ---)
                    if (!tableLine.includes('---')) {
                        let cells = tableLine.split('|')
                            .filter(cell => cell.trim() !== '')
                            .map(cell => cell.trim());
                            
                        tableHTML += '<tr>';
                        cells.forEach(cell => {
                            let cellContent = cell
                                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                                .replace(/\*(.*?)\*/g, '<em>$1</em>');
                                
                            if (isHeader) {
                                tableHTML += `<th>${cellContent}</th>`;
                            } else {
                                tableHTML += `<td>${cellContent}</td>`;
                            }
                        });
                        tableHTML += '</tr>\n';
                        isHeader = false;
                    }
                });
                
                tableHTML += '</table>';
                newLines.push(tableHTML);
                inTable = false;
            }
            newLines.push(line);
        }
    }
    
    // Si la última línea era parte de una tabla
    if (inTable) {
        let tableHTML = '<table class="rubrica-tabla">\n';
        let isHeader = true;
        
        tableLines.forEach((tableLine, index) => {
            if (!tableLine.includes('---')) {
                let cells = tableLine.split('|')
                    .filter(cell => cell.trim() !== '')
                    .map(cell => cell.trim());
                    
                tableHTML += '<tr>';
                cells.forEach(cell => {
                    let cellContent = cell
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*(.*?)\*/g, '<em>$1</em>');
                        
                    if (isHeader) {
                        tableHTML += `<th>${cellContent}</th>`;
                    } else {
                        tableHTML += `<td>${cellContent}</td>`;
                    }
                });
                tableHTML += '</tr>\n';
                isHeader = false;
            }
        });
        
        tableHTML += '</table>';
        newLines.push(tableHTML);
    }

    formatoHTML = newLines.join('\n');

    // Procesar formato normal
    formatoHTML = formatoHTML
        .replace(/^#### (.*$)/gm, '<h4>$1</h4>')
        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
        .replace(/^# (.*$)/gm, '<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/^\s*[-*]\s+(.+)$/gm, '<li>$1</li>')
        .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>')
        .replace(/\n\n/g, '<br><br>');

    // Restaurar fórmulas
    formulas.forEach((formula, i) => {
        formatoHTML = formatoHTML.replace(`##FORMULA${i}##`, 
            `<div class="math-formula">${formula}</div>`);
    });

    return formatoHTML;
}

// Función para aplicar comandos de formato
function formatText(command) {
    const contentDiv = document.getElementById('contenidoRubrica');
    contentDiv.focus();
    if (command === 'h1' || command === 'h2' || command === 'h3' || command === 'h4') {
        document.execCommand('formatBlock', false, command.toUpperCase());
    } else {
        document.execCommand(command, false, null);
    }
}

// Función para cambiar el color del texto
function changeColor(color) {
    const contentDiv = document.getElementById('contenidoRubrica');
    contentDiv.focus();
    document.execCommand('foreColor', false, color);
}

// Función para aplicar resaltado
function applyHighlight() {
    const contentDiv = document.getElementById('contenidoRubrica');
    contentDiv.focus();
    const color = document.getElementById('highlightColorPicker').value;
    document.execCommand('hiliteColor', false, color);
}

// Función para cambiar el tamaño de fuente
function changeFontSize(size) {
    const contentDiv = document.getElementById('contenidoRubrica');
    contentDiv.focus();

    document.execCommand('styleWithCSS', false, true);
    
    let fontSize;
    switch (size) {
        case '1': fontSize = '8px'; break;
        case '2': fontSize = '10px'; break;
        case '3': fontSize = '12px'; break;
        case '4': fontSize = '16px'; break;
        case '5': fontSize = '18px'; break;
        case '6': fontSize = '24px'; break;
        case '7': fontSize = '32px'; break;
        default: fontSize = '12px';
    }

    document.execCommand('fontSize', false, '7');
    const fontElements = contentDiv.querySelectorAll('font[size="7"]');
    fontElements.forEach(element => {
        element.removeAttribute('size');
        element.style.fontSize = fontSize;
    });
}

// Función para previsualizar el contenido
function previsualizarContenido() {
    const texto = document.getElementById('rubricaInput').value;
    if (!texto.trim()) {
        alert('Por favor, pegá el texto antes de previsualizar.');
        return;
    }

    const preview = document.getElementById('preview');
    const contenidoRubrica = document.getElementById('contenidoRubrica');
    
    // Asegurarse que el contenido sea editable
    contenidoRubrica.setAttribute('contenteditable', 'true');
    
    // Limpiar y establecer el nuevo contenido
    contenidoRubrica.innerHTML = formatearTexto(texto);
    
    // Mostrar la previsualización
    preview.style.display = 'block';
    
    // Renderizar fórmulas matemáticas si están disponibles
    if (window.MathJax && typeof MathJax.typesetPromise === 'function') {
        MathJax.typesetPromise([preview])
            .then(() => {
                preview.scrollIntoView({ behavior: 'smooth' });
            })
            .catch((err) => console.error('Error al renderizar fórmulas:', err));
    } else {
        preview.scrollIntoView({ behavior: 'smooth' });
    }
}

// Función para imprimir el contenido
function imprimirContenido() {
    const preview = document.getElementById('preview');
    const contenidoRubrica = document.getElementById('contenidoRubrica');
    
    if (preview.style.display === 'none') {
        alert('Por favor, previsualiza el contenido antes de imprimir.');
        return;
    }

    const ventanaImprimir = window.open('', '_blank');
    ventanaImprimir.document.write(`
        <html>
        <head>
            <title>Material Didáctico</title>
            <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"><\/script>
            <script>
                window.MathJax = {
                    tex: {
                        inlineMath: [['$', '$'], ['\\\\(', '\\\\)']],
                        displayMath: [['$$', '$$'], ['\\\\[', '\\\\]']],
                        processEscapes: true,
                        tags: 'none'
                    },
                    svg: {
                        fontCache: 'global'
                    },
                    startup: {
                        pageReady: () => {
                            return MathJax.startup.defaultPageReady().then(() => {
                                setTimeout(function() {
                                    window.print();
                                    window.close();
                                }, 1000);
                            });
                        }
                    }
                };
            <\/script>
            <style>
                @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
                body { 
                    font-family: 'Roboto', sans-serif; 
                    padding: 20px;
                    color: inherit;
                }
                * { 
                    -webkit-print-color-adjust: exact !important;
                    color-adjust: exact !important;
                    print-color-adjust: exact !important;
                }
                img { max-width: 100%; height: auto; }
                iframe, video, audio { max-width: 100%; }
                .logo-container1 { text-align: center; margin-top: 10px; }
                .logo-container1 img { width: 60px; }
                h1, h2, h3, h4 { color: #007bff; }
                a { color: #007bff; }
                .math-formula { 
                    margin: 1em 0;
                    page-break-inside: avoid;
                }
                table { 
                    border-collapse: collapse; 
                    width: 100%; 
                    margin: 20px 0;
                    page-break-inside: avoid;
                }
                th, td { 
                    border: 1px solid #ddd; 
                    padding: 12px; 
                    text-align: left;
                }
                th { background-color: #f8f9fa; }
                tr:nth-child(even) { background-color: #f9f9f9; }
            </style>
        </head>
        <body>
            <div class="logo-container1">
                <img src="https://www.henryford.edu.ar/uploads/logo512_f4b4cdb9e9.png" alt="Logo Henry Ford">
            </div>
            
            ${contenidoRubrica.innerHTML}
        </body>
        </html>
    `);
    
    ventanaImprimir.document.close();
}

// Función para borrar el contenido
function borrarContenido() {
    document.getElementById('rubricaInput').value = '';
    document.getElementById('contenidoRubrica').innerHTML = '';
    document.getElementById('preview').style.display = 'none';
}

// Event Listener para previsualización automática
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('rubricaInput').addEventListener('input', function() {
        const preview = document.getElementById('preview');
        const contenidoRubrica = document.getElementById('contenidoRubrica');
        
        if (this.value.trim()) {
            contenidoRubrica.innerHTML = formatearTexto(this.value);
            preview.style.display = 'block';
            // Renderizar fórmulas matemáticas
            if (window.MathJax) {
                MathJax.typesetPromise().catch((err) => 
                    console.log('Error al renderizar fórmulas:', err));
            }
        } else {
            preview.style.display = 'none';
        }
    });
});

// Event Listener para barra de herramientas fija
window.addEventListener('scroll', function() {
    const toolbar = document.querySelector('.editor-toolbar');
    if (window.scrollY > 200) {
        toolbar.classList.add('sticky');
    } else {
        toolbar.classList.remove('sticky');
    }
});
      // Parte 2: Funciones de medios y diálogos

// Variable para almacenar el elemento multimedia seleccionado actualmente
let selectedMedia = null;
let currentMediaUrl = '';
let currentMediaType = '';
let lastCaretPosition = null;
      
      function saveCaretPosition() {
    const selection = window.getSelection();
    if (selection.rangeCount > 0) {
        lastCaretPosition = selection.getRangeAt(0);
    }
}
// Función para validar URLs
function validateUrl(url) {
    try {
        new URL(url);
        return true;
    } catch {
        return false;
    }
}

// Funciones para mostrar/cerrar diálogos personalizados
function showCustomDialog(dialogId) {
    document.getElementById(dialogId + 'Overlay').style.display = 'block';
    document.getElementById(dialogId).style.display = 'block';
    // Limpiar campos y errores
    const inputs = document.querySelectorAll(`#${dialogId} input`);
    inputs.forEach(input => input.value = '');
    const errors = document.querySelectorAll(`#${dialogId} .error-message`);
    errors.forEach(error => error.style.display = 'none');
}

function closeCustomDialog(dialogId) {
    document.getElementById(dialogId + 'Overlay').style.display = 'none';
    document.getElementById(dialogId).style.display = 'none';
    
    // Restaurar el foco y la selección en el editor
    const contentDiv = document.getElementById('contenidoRubrica');
    contentDiv.focus();
    
    if (savedRange) {
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(savedRange);
    }
}

// Función para insertar enlaces
function insertLink() {
    // Prevenir el diálogo predeterminado del navegador
    event.preventDefault();
    
    // Guardar la selección actual
    const selection = window.getSelection();
    const range = selection.getRangeAt(0);
    const selectedText = range.toString();
    
    // Mostrar el diálogo personalizado
    document.getElementById('linkDialogOverlay').style.display = 'block';
    document.getElementById('linkDialog').style.display = 'block';
    
    // Pre-llenar el texto seleccionado si existe
    document.getElementById('linkText').value = selectedText;
    document.getElementById('linkUrl').value = '';
    document.getElementById('linkUrlError').style.display = 'none';
}

// Función para insertar el enlace desde el diálogo personalizado
function insertCustomLink() {
    const url = document.getElementById('linkUrl').value;
    const text = document.getElementById('linkText').value;
    
    if (!validateUrl(url)) {
        document.getElementById('linkUrlError').style.display = 'block';
        return;
    }
    
    const contentDiv = document.getElementById('contenidoRubrica');
    contentDiv.focus();
    
    // Crear el enlace HTML
    const linkHtml = `<a href="${url}" target="_blank">${text || url}</a>`;
    
    // Insertar el enlace
    document.execCommand('insertHTML', false, linkHtml);
    
    // Cerrar el diálogo
    closeCustomDialog('linkDialog');
}

// Función para insertar imágenes
let activeImageTab = 'url';

function switchImageTab(tab) {
    activeImageTab = tab;
    const tabs = document.querySelectorAll('.tab-button');
    const contents = document.querySelectorAll('.tab-content');
    
    tabs.forEach(t => t.classList.remove('active'));
    document.querySelector(`.tab-button:nth-child(${tab === 'url' ? '1' : '2'})`).classList.add('active');
    
    document.getElementById('urlTab').style.display = tab === 'url' ? 'block' : 'none';
    document.getElementById('fileTab').style.display = tab === 'file' ? 'block' : 'none';
}

function insertCustomImage() {
    if (activeImageTab === 'url') {
        insertImageFromUrl();
    } else {
        insertImageFromFile();
    }
}

function insertImageFromUrl() {
    const url = document.getElementById('imageUrl').value;
    
    if (!validateUrl(url)) {
        document.getElementById('imageUrlError').style.display = 'block';
        return;
    }

    insertImageToEditor(url);
}

function insertImageFromFile() {
    const fileInput = document.getElementById('imageFile');
    const file = fileInput.files[0];
    
    if (!file || !file.type.startsWith('image/')) {
        document.getElementById('imageFileError').style.display = 'block';
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        insertImageToEditor(e.target.result);
    };
    reader.readAsDataURL(file);
}

function insertImageToEditor(src) {
    const contentDiv = document.getElementById('contenidoRubrica');
    const html = `<div class="media-container"><img src="${src}" alt="Imagen insertada" style="max-width:100%;"></div><p></p>`;

    if (lastCaretPosition) {
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(lastCaretPosition);
        
        const range = selection.getRangeAt(0);
        const fragment = range.createContextualFragment(html);
        range.insertNode(fragment);
        
        range.collapse(false);
        selection.removeAllRanges();
        selection.addRange(range);
    } else {
        contentDiv.innerHTML += html;
    }

    closeCustomDialog('imageDialog');
}

// Modificar la función que abre el diálogo
function insertImage() {
    saveCaretPosition();
    showCustomDialog('imageDialog');
    
    // Resetear el formulario
    document.getElementById('imageUrl').value = '';
    document.getElementById('imageFile').value = '';
    document.getElementById('imageUrlError').style.display = 'none';
    document.getElementById('imageFileError').style.display = 'none';
    
    // Resetear a la pestaña URL por defecto
    switchImageTab('url');
}
// Función para obtener ID de YouTube
function getYouTubeVideoId(url) {
    const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/;
    const match = url.match(regExp);
    return (match && match[7].length == 11) ? match[7] : null;
}

// Función para insertar videos
function insertVideo() {
    // Guardar la posición actual del cursor
    saveCaretPosition();
    
    // Mostrar el diálogo
    document.getElementById('videoDialogOverlay').style.display = 'block';
    document.getElementById('videoDialog').style.display = 'block';
    
    // Limpiar campos
    document.getElementById('videoUrl').value = '';
    document.getElementById('videoUrlError').style.display = 'none';
}

// Función para insertar el video desde el diálogo personalizado
function insertCustomVideo() {
    const url = document.getElementById('videoUrl').value;
    
    if (!validateUrl(url)) {
        document.getElementById('videoUrlError').style.display = 'block';
        return;
    }

    const contentDiv = document.getElementById('contenidoRubrica');
    
    let html = '';
    if (url.includes('youtube.com') || url.includes('youtu.be')) {
        const videoId = getYouTubeVideoId(url);
        if (videoId) {
            html = `<div class="media-container"><iframe width="560" height="315" 
                src="https://www.youtube.com/embed/${videoId}" 
                frameborder="0" allowfullscreen></iframe></div><p></p>`;
        }
    } else {
        html = `<div class="media-container"><video src="${url}" controls width="560" height="315" style="max-width:100%;"></video></div><p></p>`;
    }

    // Restaurar la posición del cursor y insertar el video
    if (lastCaretPosition) {
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(lastCaretPosition);
        
        // Insertar el HTML en la posición del cursor
        const range = selection.getRangeAt(0);
        const fragment = range.createContextualFragment(html);
        range.insertNode(fragment);
        
        // Mover el cursor al final del video insertado
        range.collapse(false);
        selection.removeAllRanges();
        selection.addRange(range);
    } else {
        // Si no hay posición guardada, insertar al final
        contentDiv.innerHTML += html;
    }

    // Cerrar el diálogo
    closeCustomDialog('videoDialog');
    
    // Limpiar la posición guardada
    lastCaretPosition = null;
}

// Asegurarse de que el editor mantenga el seguimiento del cursor
document.addEventListener('DOMContentLoaded', function() {
    const contentDiv = document.getElementById('contenidoRubrica');
    contentDiv.addEventListener('click', saveCaretPosition);
    contentDiv.addEventListener('keyup', saveCaretPosition);
});

// Función para insertar H5P
function insertH5P() {
    showCustomDialog('h5pDialog');
}

// Función para insertar contenido H5P desde el diálogo
function insertCustomH5P() {
    const url = document.getElementById('h5pUrl').value;
    
    if (!validateUrl(url)) {
        document.getElementById('h5pUrlError').style.display = 'block';
        return;
    }

    const contentDiv = document.getElementById('contenidoRubrica');
    contentDiv.focus();
    document.execCommand('insertHTML', false, 
        `<iframe src="${url}" width="800" height="600" 
        frameborder="0" allowfullscreen="true"></iframe>`);
    closeCustomDialog('h5pDialog');
  
  document.execCommand('insertHTML', false, 
        `<div class="media-container h5p-container">
            <iframe src="${url}" width="800" height="600" frameborder="0" allowfullscreen="true"></iframe>
            <div class="resize-handle"></div>
        </div>`);
}

// Funciones para manejo de elementos multimedia
function initMediaEvents() {
    const contenidoRubrica = document.getElementById('contenidoRubrica');
    
    // Listener para detectar clicks en imágenes y videos
    contenidoRubrica.addEventListener('click', function(e) {
        const target = e.target;
        if (target.tagName === 'IMG' || target.tagName === 'VIDEO' || 
            (target.tagName === 'IFRAME' && target.getAttribute('src').includes('youtube'))) {
            
            // Deseleccionar el elemento anterior
            if (selectedMedia && selectedMedia !== target) {
                selectedMedia.classList.remove('media-selected');
            }
            
            // Seleccionar el nuevo elemento
            selectedMedia = target;
            selectedMedia.classList.add('media-selected');
            
            // Mostrar la barra de herramientas de medios
            document.querySelector('.media-tools').style.display = 'flex';
            
            // Si el elemento no está en un contenedor, envolverlo en uno
            if (!target.parentElement.classList.contains('media-container')) {
                const container = document.createElement('div');
                container.className = 'media-container';
                target.parentNode.insertBefore(container, target);
                container.appendChild(target);
            }
        } else if (!e.target.closest('.media-tools')) {
            // Si se hace clic fuera del elemento multimedia y de la barra de herramientas
            if (selectedMedia) {
                selectedMedia.classList.remove('media-selected');
                selectedMedia = null;
                document.querySelector('.media-tools').style.display = 'none';
            }
        }
    });
}


// Event listeners para cerrar diálogos y manejar tecla Escape
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar eventos de medios
    initMediaEvents();
    
    // Event listeners para cerrar diálogos al hacer clic en el overlay
    const overlays = document.querySelectorAll('.custom-dialog-overlay');
    overlays.forEach(overlay => {
        overlay.addEventListener('click', function(e) {
            if (e.target === overlay) {
                const dialogId = overlay.id.replace('Overlay', '');
                closeCustomDialog(dialogId);
            }
        });
    });
    
    // Event listeners para cerrar con la tecla Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const visibleDialog = document.querySelector('.custom-dialog[style*="display: block"]');
            if (visibleDialog) {
                const dialogId = visibleDialog.id;
                closeCustomDialog(dialogId);
            }
        }
    });
});
      // Parte 3: Funciones de grabación de audio y video

// Variables globales para grabación
let mediaRecorder = null;
let recordedChunks = [];
let mediaStream = null;
let timerInterval = null;
let startTime = null;
let recordingType = null;

// Función principal de grabación
async function startRecording(type) {
    try {
        if (mediaRecorder && mediaRecorder.state === 'recording') {
            return;
        }

        // Verificar si el navegador soporta la API
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            throw new Error('Tu navegador no soporta la grabación de medios. Por favor, usa Chrome, Firefox o Edge actualizado.');
        }

        // Solicitar permisos explícitamente
        const constraints = {
            audio: {
                echoCancellation: true,
                noiseSuppression: true,
                sampleRate: 44100
            },
            video: type === 'video' ? {
                width: { ideal: 1280 },
                height: { ideal: 720 },
                facingMode: 'user'
            } : false
        };

        try {
            mediaStream = await navigator.mediaDevices.getUserMedia(constraints);
        } catch (permissionError) {
            if (permissionError.name === 'NotAllowedError') {
                throw new Error('Por favor, permite el acceso a tu ' + (type === 'video' ? 'cámara y micrófono' : 'micrófono') + ' para continuar.');
            } else if (permissionError.name === 'NotFoundError') {
                throw new Error('No se encontró ningún dispositivo de ' + (type === 'video' ? 'video/audio' : 'audio') + '. Por favor, verifica que esté conectado correctamente.');
            } else {
                throw permissionError;
            }
        }
        
        // Configurar vista previa de video si es necesario
        if (type === 'video') {
            const videoPreview = document.getElementById('videoPreview');
            videoPreview.srcObject = mediaStream;
            videoPreview.play().catch(console.error);
        }
        
        // Intentar crear el MediaRecorder con diferentes códecs
        let options = {};
        const mimeTypes = type === 'video' 
            ? ['video/webm;codecs=vp8,opus', 'video/webm', 'video/mp4']
            : ['audio/webm;codecs=opus', 'audio/webm', 'audio/mp4'];
            
        for (const mimeType of mimeTypes) {
            if (MediaRecorder.isTypeSupported(mimeType)) {
                options = { mimeType };
                break;
            }
        }

        mediaRecorder = new MediaRecorder(mediaStream, options);
        recordedChunks = [];
        recordingType = type;
        
        // Configurar event handlers del MediaRecorder
        mediaRecorder.ondataavailable = (e) => {
            if (e.data.size > 0) {
                recordedChunks.push(e.data);
            }
        };
        
        mediaRecorder.onstop = () => {
            const blob = new Blob(recordedChunks, {
                type: mediaRecorder.mimeType
            });
            const url = URL.createObjectURL(blob);
            const preview = document.getElementById(`${type}Preview`);
            preview.src = url;
            preview.srcObject = null;
            
            // Actualizar interfaz
            document.getElementById(`start${type.charAt(0).toUpperCase() + type.slice(1)}Record`).style.display = 'none';
            document.getElementById(`stop${type.charAt(0).toUpperCase() + type.slice(1)}Record`).style.display = 'none';
            document.getElementById(`save${type.charAt(0).toUpperCase() + type.slice(1)}Record`).style.display = 'inline-flex';
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        };
        
        // Iniciar grabación y temporizador
        mediaRecorder.start(1000); // Fragmentar la grabación cada segundo
        startTime = new Date();
        timerInterval = setInterval(() => updateTimer(`${type}Timer`), 1000);
        
        // Actualizar interfaz
        document.getElementById(`${type}Status`).textContent = 'Grabando...';
        document.getElementById(`start${type.charAt(0).toUpperCase() + type.slice(1)}Record`).style.display = 'none';
        document.getElementById(`stop${type.charAt(0).toUpperCase() + type.slice(1)}Record`).style.display = 'inline-flex';
        
    } catch (error) {
        console.error('Error al iniciar la grabación:', error);
        const errorElement = document.getElementById(`${type}Error`);
        errorElement.textContent = error.message;
        errorElement.style.display = 'block';
        
        // Asegurarse de limpiar los recursos si hay un error
        if (mediaStream) {
            stopMediaStream();
        }
    }
}

// Función para detener la grabación
function stopRecording() {
    if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
        stopMediaStream();
        if (timerInterval) {
            clearInterval(timerInterval);
            timerInterval = null;
        }
        document.getElementById(`${recordingType}Status`).textContent = 'Grabación completada';
    }
}

// Función para guardar la grabación
function saveRecording() {
    if (recordedChunks.length === 0) return;
    
    const blob = new Blob(recordedChunks, {
        type: recordingType === 'video' ? 'video/webm' : 'audio/webm'
    });
    const url = URL.createObjectURL(blob);
    
    // Insertar en el editor
    const contentDiv = document.getElementById('contenidoRubrica');
    contentDiv.focus();
    
    const mediaElement = recordingType === 'video' 
        ? `<div class="media-container"><video src="${url}" controls style="max-width:100%;"></video></div>`
        : `<div class="media-container"><audio src="${url}" controls></audio></div>`;
    
    document.execCommand('insertHTML', false, mediaElement);
    closeRecordingDialog(recordingType);
}

// Función para detener el stream de medios
function stopMediaStream() {
    if (mediaStream) {
        mediaStream.getTracks().forEach(track => track.stop());
        mediaStream = null;
    }
}

// Función para actualizar el temporizador
function updateTimer(timerId) {
    const now = new Date();
    const diff = now - startTime;
    const minutes = Math.floor(diff / 60000);
    const seconds = Math.floor((diff % 60000) / 1000);
    document.getElementById(timerId).textContent = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// Función para mostrar el diálogo de grabación
function showRecordingDialog(type) {
    recordingType = type;
    const dialogId = `${type}RecordingDialog`;
    const overlayId = `${type}RecordingOverlay`;
    
    document.getElementById(overlayId).style.display = 'block';
    document.getElementById(dialogId).style.display = 'block';
    
    // Resetear la interfaz
    document.getElementById(`${type}Timer`).textContent = '00:00';
    document.getElementById(`${type}Status`).textContent = 'El navegador solicitará permisos para acceder a tu ' + 
        (type === 'video' ? 'cámara y micrófono' : 'micrófono') + '. Por favor, permite el acceso cuando se te solicite.';
    document.getElementById(`${type}Error`).style.display = 'none';
    document.getElementById(`start${type.charAt(0).toUpperCase() + type.slice(1)}Record`).style.display = 'inline-flex';
    document.getElementById(`stop${type.charAt(0).toUpperCase() + type.slice(1)}Record`).style.display = 'none';
    document.getElementById(`save${type.charAt(0).toUpperCase() + type.slice(1)}Record`).style.display = 'none';
    
    const preview = document.getElementById(`${type}Preview`);
    preview.srcObject = null;
    preview.src = '';
}

// Función para cerrar el diálogo de grabación
function closeRecordingDialog(type) {
    const dialogId = `${type}RecordingDialog`;
    const overlayId = `${type}RecordingOverlay`;
    
    document.getElementById(dialogId).style.display = 'none';
    document.getElementById(overlayId).style.display = 'none';
    
    // Detener la grabación si está activa
    if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
    }
    
    // Limpiar el stream de medios
    stopMediaStream();
    
    // Detener el temporizador
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
    
    // Resetear la interfaz
    document.getElementById(`${type}Timer`).textContent = '00:00';
    document.getElementById(`${type}Status`).textContent = 'Listo para grabar';
    document.getElementById(`${type}Error`).style.display = 'none';
    
    // Limpiar la vista previa
    const preview = document.getElementById(`${type}Preview`);
    preview.srcObject = null;
    preview.src = '';
}

// Inicializar event listeners cuando el documento esté listo
document.addEventListener('DOMContentLoaded', function() {
    // Audio recording buttons
    document.getElementById('startAudioRecord').addEventListener('click', () => startRecording('audio'));
    document.getElementById('stopAudioRecord').addEventListener('click', stopRecording);
    document.getElementById('saveAudioRecord').addEventListener('click', saveRecording);
    document.getElementById('cancelAudioRecord').addEventListener('click', () => closeRecordingDialog('audio'));

    // Video recording buttons
    document.getElementById('startVideoRecord').addEventListener('click', () => startRecording('video'));
    document.getElementById('stopVideoRecord').addEventListener('click', stopRecording);
    document.getElementById('saveVideoRecord').addEventListener('click', saveRecording);
    document.getElementById('cancelVideoRecord').addEventListener('click', () => closeRecordingDialog('video'));
});
      // Parte 4: Funciones de autoguardado y gestión de archivos

// Variables globales para el autoguardado
let autoSaveInterval = null;
const AUTO_SAVE_DELAY = 30000; // 30 segundos

// Función para descargar el contenido
function descargarContenido() {
    const preview = document.getElementById('preview');
    const contenidoRubrica = document.getElementById('contenidoRubrica');
    
    if (preview.style.display === 'none') {
        alert('Por favor, previsualiza el contenido antes de descargar.');
        return;
    }

    const htmlContent = `<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Material Didáctico</title>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"><\/script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\\\(', '\\\\)']],
                displayMath: [['$$', '$$'], ['\\\\[', '\\\\]']],
                processEscapes: true,
                tags: 'none'
            },
            svg: {
                fontCache: 'global'
            }
        };
    <\/script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
        body { 
            font-family: 'Roboto', sans-serif; 
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        img { max-width: 100%; height: auto; }
        iframe, video, audio { max-width: 100%; }
        .logo-container { text-align: center; margin-bottom: 20px; }
        .logo-container img { width: 80px; }
        h1, h2, h3, h4 { color: #007bff; }
        a { color: #007bff; }
        .math-formula { margin: 1em 0; }
        table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 20px 0;
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 12px; 
            text-align: left;
        }
        th { background-color: #f8f9fa; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .media-container {
            margin: 10px 0;
            max-width: 100%;
        }
        .media-container img,
        .media-container video,
        .media-container audio {
            max-width: 100%;
        }
        .media-container.align-left { float: left; margin-right: 20px; }
        .media-container.align-center { display: block; margin: 0 auto; text-align: center; }
        .media-container.align-right { float: right; margin-left: 20px; }
    </style>
</head>
<body>
    <div class="logo-container">
        <img src="https://www.henryford.edu.ar/uploads/logo512_f4b4cdb9e9.png" alt="Logo Henry Ford">
    </div>
    
    ${contenidoRubrica.innerHTML}
</body>
</html>`;

    const blob = new Blob([htmlContent], { type: 'text/html' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    const timestamp = new Date().toISOString().slice(0,19).replace(/:/g, '-');
    a.download = `material_didactico_${timestamp}.html`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

// Función para guardar el estado actual
function saveCurrentEdit() {
    // Obtener el contenido actual
    const content = {
        input: document.getElementById('rubricaInput').value,
        preview: document.getElementById('contenidoRubrica').innerHTML,
        timestamp: new Date().toISOString()
    };
    
    // Crear el blob con el contenido
    const blob = new Blob([JSON.stringify(content)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    // Crear el enlace de descarga
    const a = document.createElement('a');
    a.href = url;
    const timestamp = new Date().toISOString().slice(0,19).replace(/:/g, '-');
    a.download = `edicion_${timestamp}.json`;
    
    // Descargar el archivo
    document.body.appendChild(a);
    a.click();
    
    // Limpiar
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Función para cargar una edición guardada
function loadSavedEdit() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            try {
                const content = JSON.parse(e.target.result);
                
                // Restaurar el contenido
                document.getElementById('rubricaInput').value = content.input;
                document.getElementById('contenidoRubrica').innerHTML = content.preview;
                document.getElementById('preview').style.display = 'block';
                
                // Opcional: Mostrar mensaje de éxito
                alert('Edición cargada correctamente');
                
            } catch (error) {
                console.error('Error al cargar el archivo:', error);
                alert('Error al cargar el archivo. Asegúrate de que sea un archivo de edición válido.');
            }
        };
        
        reader.onerror = function() {
            alert('Error al leer el archivo');
        };
        
        reader.readAsText(file);
    };
    
    input.click();
}

// Modificar la barra de herramientas para incluir los nuevos botones
function initSaveLoadButtons() {
    const toolbarGroup = document.createElement('div');
    toolbarGroup.className = 'toolbar-group';
    toolbarGroup.innerHTML = `
        <button class="tool-button" onclick="saveCurrentEdit()" title="Guardar edición actual">
            <i class="fas fa-save"></i>
        </button>
        <button class="tool-button" onclick="loadSavedEdit()" title="Cargar edición guardada">
            <i class="fas fa-folder-open"></i>
        </button>
    `;
    
    document.querySelector('.editor-toolbar').appendChild(toolbarGroup);
}

// Inicializar los botones cuando el documento esté listo
document.addEventListener('DOMContentLoaded', function() {
    initSaveLoadButtons();
});
      
      // Función para inicializar eventos de redimensión para H5P
function initH5PResizeEvents() {
    const contenidoRubrica = document.getElementById('contenidoRubrica');

    let isResizing = false;
    let currentH5P = null;
    let initialX = 0;
    let initialY = 0;
    let initialWidth = 0;
    let initialHeight = 0;

    contenidoRubrica.addEventListener('mousedown', (e) => {
        const target = e.target;
        if (target.classList.contains('resize-handle')) {
            isResizing = true;
            currentH5P = target.previousElementSibling; // El iframe es el hermano anterior
            initialX = e.clientX;
            initialY = e.clientY;
            initialWidth = currentH5P.offsetWidth;
            initialHeight = currentH5P.offsetHeight;
        }
    });

    document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;

        const deltaX = e.clientX - initialX;
        const deltaY = e.clientY - initialY;

        currentH5P.style.width = `${initialWidth + deltaX}px`;
        currentH5P.style.height = `${initialHeight + deltaY}px`;
    });

    document.addEventListener('mouseup', () => {
        isResizing = false;
        currentH5P = null;
    });
}

// Llamar a la función para inicializar los eventos de redimensión
initH5PResizeEvents();
      
function increaseMediaSize() {
    if (!selectedMedia) return;
    
    // Obtener el tamaño actual
    let currentWidth = selectedMedia.getBoundingClientRect().width;
    let currentHeight = selectedMedia.getBoundingClientRect().height;
    
    // Calcular nuevo tamaño (aumentar 20%)
    let newWidth = currentWidth * 1.2;
    let aspectRatio = currentHeight / currentWidth;
    let newHeight = newWidth * aspectRatio;
    
    // Aplicar nuevos tamaños
    selectedMedia.style.width = `${newWidth}px`;
    selectedMedia.style.height = `${newHeight}px`;
    
    // Guardar el último tamaño aplicado
    selectedMedia.dataset.lastWidth = newWidth;
    selectedMedia.dataset.lastHeight = newHeight;
}

function decreaseMediaSize() {
    if (!selectedMedia) return;
    
    // Obtener el tamaño actual
    let currentWidth = selectedMedia.getBoundingClientRect().width;
    let currentHeight = selectedMedia.getBoundingClientRect().height;
    
    // Calcular nuevo tamaño (reducir 20%)
    let newWidth = Math.max(currentWidth * 0.8, 100); // No menor a 100px
    let aspectRatio = currentHeight / currentWidth;
    let newHeight = newWidth * aspectRatio;
    
    // Aplicar nuevos tamaños
    selectedMedia.style.width = `${newWidth}px`;
    selectedMedia.style.height = `${newHeight}px`;
    
    // Guardar el último tamaño aplicado
    selectedMedia.dataset.lastWidth = newWidth;
    selectedMedia.dataset.lastHeight = newHeight;
}

// Función para inicializar el elemento seleccionado
function initializeSelectedMedia(element) {
    selectedMedia = element;
    
    // Si no tiene dimensiones establecidas, establecer las iniciales
    if (!selectedMedia.style.width) {
        const rect = selectedMedia.getBoundingClientRect();
        selectedMedia.style.width = `${rect.width}px`;
        selectedMedia.style.height = `${rect.height}px`;
        
        // Guardar dimensiones iniciales
        selectedMedia.dataset.initialWidth = rect.width;
        selectedMedia.dataset.initialHeight = rect.height;
    }
    
    // Añadir clase para estilos
    selectedMedia.classList.add('resizable');
}
      
      
      let isDragging = false;
let currentX;
let currentY;
let initialX;
let initialY;
let xOffset = 0;
let yOffset = 0;

// Función para inicializar el elemento seleccionado
function initializeSelectedMedia(element) {
    selectedMedia = element;
    
    // Si no tiene dimensiones establecidas, establecer las iniciales
    if (!selectedMedia.style.width) {
        const rect = selectedMedia.getBoundingClientRect();
        selectedMedia.style.width = `${rect.width}px`;
        selectedMedia.style.height = `${rect.height}px`;
        
        // Guardar dimensiones iniciales
        selectedMedia.dataset.initialWidth = rect.width;
        selectedMedia.dataset.initialHeight = rect.height;
    }
    
    // Añadir clases necesarias
    selectedMedia.classList.add('resizable', 'draggable');
    
    // Mostrar la barra de herramientas
    document.querySelector('.media-tools').style.display = 'flex';
    
    // Configurar eventos para arrastrar
    setupDragEvents(selectedMedia);
}

function setupDragEvents(element) {
    // Eventos del mouse
    element.addEventListener('mousedown', startDragging);
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', stopDragging);
    
    // Eventos táctiles para móviles
    element.addEventListener('touchstart', startDragging);
    document.addEventListener('touchmove', drag);
    document.addEventListener('touchend', stopDragging);
}

function startDragging(e) {
    if (e.type === 'mousedown') {
        initialX = e.clientX - xOffset;
        initialY = e.clientY - yOffset;
    } else if (e.type === 'touchstart') {
        initialX = e.touches[0].clientX - xOffset;
        initialY = e.touches[0].clientY - yOffset;
    }
    
    if (e.target === selectedMedia) {
        isDragging = true;
    }
}

function drag(e) {
    if (isDragging) {
        e.preventDefault();
        
        if (e.type === 'mousemove') {
            currentX = e.clientX - initialX;
            currentY = e.clientY - initialY;
        } else if (e.type === 'touchmove') {
            currentX = e.touches[0].clientX - initialX;
            currentY = e.touches[0].clientY - initialY;
        }

        xOffset = currentX;
        yOffset = currentY;
        
        // Obtener límites del área de previsualización
        const previewArea = selectedMedia.parentElement;
        const previewRect = previewArea.getBoundingClientRect();
        const elementRect = selectedMedia.getBoundingClientRect();
        
        // Limitar el movimiento dentro del área de previsualización
        if (currentX < 0) currentX = 0;
        if (currentY < 0) currentY = 0;
        if (currentX > previewRect.width - elementRect.width) {
            currentX = previewRect.width - elementRect.width;
        }
        if (currentY > previewRect.height - elementRect.height) {
            currentY = previewRect.height - elementRect.height;
        }
        
        setTranslate(currentX, currentY, selectedMedia);
    }
}

function stopDragging() {
    initialX = currentX;
    initialY = currentY;
    isDragging = false;
}

function setTranslate(xPos, yPos, el) {
    el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
}

// Función para resetear la posición
function resetPosition() {
    xOffset = 0;
    yOffset = 0;
    currentX = 0;
    currentY = 0;
    selectedMedia.style.transform = 'translate3d(0px, 0px, 0)';
}
      
       // Funciones para Z-index
        function bringToFront() {
            if (selectedMedia) {
                const currentZIndex = parseInt(selectedMedia.style.zIndex) || 0;
                selectedMedia.style.zIndex = Math.max(currentZIndex, getMaxZIndex()) + 1;
            }
        }

        function sendToBack() {
            if (selectedMedia) {
                const currentZIndex = parseInt(selectedMedia.style.zIndex) || 0;
                selectedMedia.style.zIndex = Math.min(currentZIndex, getMinZIndex()) - 1;
            }
        }

        function getMaxZIndex() {
            const elements = document.querySelectorAll('.preview-content img, .preview-content iframe');
            let maxZ = 0;
            elements.forEach(el => {
                const z = parseInt(el.style.zIndex) || 0;
                maxZ = Math.max(maxZ, z);
            });
            return maxZ;
        }

        function getMinZIndex() {
            const elements = document.querySelectorAll('.preview-content img, .preview-content iframe');
            let minZ = 0;
            elements.forEach(el => {
                const z = parseInt(el.style.zIndex) || 0;
                minZ = Math.min(minZ, z);
            });
            return minZ;
        }

        // Crear barra de herramientas de medios
        function createToolbar() {
            if (!document.querySelector('.media-tools1')) {
                const toolbar = document.createElement('div');
                toolbar.className = 'media-tools1';
                toolbar.innerHTML = `
                    <button class="tool-button" onclick="decreaseMediaSize()" title="Reducir tamaño">
                        <i class="fas fa-compress-arrows-alt"></i>
                    </button>
                    <button class="tool-button" onclick="increaseMediaSize()" title="Aumentar tamaño">
                        <i class="fas fa-expand-arrows-alt"></i>
                    </button>
                    <button class="tool-button" onclick="bringToFront()" title="Traer al frente">
                        <i class="fas fa-level-up-alt"></i>
                    </button>
                    <button class="tool-button" onclick="sendToBack()" title="Enviar atrás">
                        <i class="fas fa-level-down-alt"></i>
                    </button>
                `;
                document.body.appendChild(toolbar);
            }
        }

        // Eventos de inicialización
        document.addEventListener('DOMContentLoaded', () => {
            createToolbar();
            initializeAllMedia();
            
            // Actualizar la vista previa cuando se edita el contenido
            document.getElementById('editor').addEventListener('input', updatePreview);
        });

        // Ocultar herramientas al hacer clic fuera
        document.addEventListener('click', (e) => {
            const toolbar = document.querySelector('.media-tools1');
            if (!e.target.closest('.media-tools1') && !e.target.closest('img') && !e.target.closest('iframe')) {
                toolbar.style.display = 'none';
                if (selectedMedia) {
                    selectedMedia.classList.remove('dragging');
                }
            }
        });
      
      
      
     function changeMathSize(action) {
    const selection = window.getSelection();
    const range = selection.getRangeAt(0);
    let formula = range.commonAncestorContainer;

    // Buscar el contenedor de la fórmula más cercano
    while (formula && !formula.classList?.contains('math-formula')) {
        formula = formula.parentElement;
    }

    if (!formula) {
        alert('Por favor, selecciona una fórmula matemática primero');
        return;
    }

    // Remover clases de tamaño existentes
    formula.classList.remove('size-large', 'size-small');

    // Aplicar nuevo tamaño
    if (action === 'increase') {
        formula.classList.add('size-large');
    } else if (action === 'decrease') {
        formula.classList.add('size-small');
    }

    // Actualizar el renderizado de MathJax
    if (window.MathJax) {
        MathJax.typesetPromise([formula]).catch(console.error);
    }
}   
        </script>
  

</div>

</body></html>
